# Курсы валют Django

## Запуск

Чтобы запустить веб-приложение, нужно:
1. Открыть терминал в корневой папке проекта, где лежит _manage.py_, например, _currencies/_
2. Вписать команду `python manage.py runserver` или  `python3 manage.py runserver`
3. Открыть браузер с хостом и портом: ***https://127.0.0.1:8000***

Также можно попробовать веб-прилложение на *https://alexotl777.pythonanywhere.com

## Методы Views

Находятся в `currencies_by_country/views.py`

### Class GetterCurrencies

Отвечает за все основные функции приложения - получение информации с сайтов, построение графика и синхронизация в БД

#### redirect_to_main

Перенаправляет с базового роута `/` на главную страницу с формой `main/`

#### get_currency_of_country

Собирает с ***[iban.ru/currency-codes](https://www.iban.ru/currency-codes)*** информацию о кодах валют стран и синхранизирует их в БД в таблице CountryCodes. В полученных данных удаляются строки, вкоторые есть _пустые_ ячейки. 

Возвращает JsonResponse с полями `Страна`, `Валюта`, `Код`, `Номер`

#### get_rates

Собирает с ***[finmarket.ru/currency/rates/](https://www.finmarket.ru/currency/rates/)*** информацию о курсах валют и синхранизирует их в БД в таблице CountryCodes, также берет начальную дату запроса, как базовую, и рассчитывает относительные изменения валют, синхронизируя их в БД.

Возвращает JsonResponse с полями `Дата`, `Доллар США`, `ЕВРО`, `Фунт стерлингов`, `Индийская рупия`, `Китайский юань Жэньминьби`, `Турецкая лира`, `Японская йена`

_Примечание: Запрос может отрабатывать долго из-за большого количества запросов на парсинг информации курсов, объема полученной информации и синхронизации относительных изменений в Базе данных. ***НО*** отрабатывает не более ***1,5 минуты***_

#### get_countries_rates

Запрашивает коды и курсы валют с помощью предыдущих двух методов, расчитывает относительные изменения курсов за определенный период с определенным списком стран, полученным из формы, и строит по этой информации график. Возвращает этот график в виде контекста в формате png BytesIO

### class MainPageForm

Отвечает за отображение формы

#### main_form

Определяет форму, которая принимает страны и интервал дат, а затем отправляет POST запрос на get_countries_rates

_bd, bm, by - начальные день, месяц и год соответсвенно_

_ed, em, ey - конечные день, месяц и год соответсвенно_

### class DateValidation

Валидирует дату на ее существование и _адекватность_

#### check_day

**Takes**: целочисленный день
        
**Returns**: целочисленный день, если он между 1 и 31, иначе вызывает ошибку

#### check_month

**Takes**: целочисленный месяц
        
**Returns**: целочисленный месяц, если он между 1 и 12, иначе вызывает ошибку

#### check_year

**Takes**: целочисленный месяц
        
**Returns**: целочисленный месяц, если он между 1 и 12, иначе вызывает ошибку

#### check_all_date

**Takes**: целочисленный день, месяц, год
        
**Returns**: None

**Проверяет** дату на ее существование и больше ли она текущей даты, иначе возвращает ошибку

#### check_interval

**Takes**: целочисленный день, месяц, год дат начала и конца интервала
        
**Returns**: None

**Проверяет**, находится ли интервал от 0 до 2 лет, иначе возвращает ошибку

## Tests

Проверяет редирект на главную страницу с формой

`/`   **===>**   `main/`

### Запуск

Чтобы запустить веб-приложение, нужно:
1. Открыть терминал в корневой папке проекта, где лежит _manage.py_, например, _currencies/_
2. Вписать команду `python manage.py test` или  `python3 manage.py test`
